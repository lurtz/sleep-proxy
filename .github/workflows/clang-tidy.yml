name: clang-tidy

on:
  pull_request:
    branches: [ "master" ]

jobs:
  clang-tidy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install dependencies for build
        run: sudo apt install meson libpcap-dev libcppunit-dev clang-tidy
      - name: Configure Meson for minimal build
        run: meson setup ${{github.workspace}}/build .
      - name: clang-tidy-diff
        run: git diff origin/master | clang-tidy-diff -p1 -path ${{github.workspace}}/build -export-fixes ${{github.workspace}}/build/fixes.yml
      - name: check result
        run: exit `stat -c %s ${{github.workspace}}/build/fixes.yml`
